# ๐ต๏ธ ุชูุฑูุฑ ูุญุต ุงููุงุฌูุงุช ุงูุจุฑูุฌูุฉ (API Inspection Report)

**ุชุงุฑูุฎ ุงููุญุต:** 21 ููููุจุฑ 2025
**ุญุงูุฉ ุงููุญุต:** โ๏ธ ูุญุชุงุฌ ุฅูู ุฅุตูุงุญุงุช ุฃูููุฉ ููููููุฉ
**ุงููููู:** AI Agent (Shomokh v3 Context)

---

## ๐จ 1. ุซุบุฑุงุช ุฃูููุฉ ุญุฑุฌุฉ (Critical Security Vulnerabilities)

ูุฐู ุงููุงุฌูุงุช ุชูุชูุฑ ุฅูู ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ุฃู ุงูููููุฉุ ููุง ูุฏ ูุณูุญ ูููุณุชุฎุฏููู ุจุงููุตูู ุฅูู ุจูุงูุงุช ุบูุฑ ูุตุฑุญ ุจูุง.

*   **`src/app/api/grades/route.ts`**
    *   **ุงููุดููุฉ:** `GET` ูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ููุท ููุง ูุชุญูู ูู ุงูุฏูุฑ ุฃู ููููุฉ ุงูุจูุงูุงุช. ูููู ูุฃู ูุณุชุฎุฏู ูุณุฌู ุฌูุจ ุฏุฑุฌุงุช ุฃู ุทุงูุจ.
    *   **ุงูุฅุตูุงุญ:** ุฅุถุงูุฉ ุงูุชุญูู ูู ุงูุฏูุฑ (`ADMIN`, `TEACHER`, `STUDENT`) ูุงูุชุญูู ูู ุงูููููุฉ (`checkCourseOwnership` ุฃู ูุทุงุจูุฉ `studentId`).

*   **`src/app/api/enrollment/manage-request/route.ts`**
    *   **ุงููุดููุฉ:** ุงููุนููุฉ ุชุณุชุทูุน ูุจูู/ุฑูุถ ุฃู ุทูุจ ุงูุถูุงู ุฅุฐุง ุนุฑูุช `requestId`ุ ุฏูู ุงูุชุญูู ูู ุฃููุง ุชููู ุงูุญููุฉ ุงููุณุชูุฏูุฉ.
    *   **ุงูุฅุตูุงุญ:** ุงูุชุญูู ูู ุฃู `request.course.teacherId` ูุทุงุจู `session.user.id`.

*   **`src/app/api/enrollment/request/route.ts` & `clear-requests/route.ts`**
    *   **ุงููุดููุฉ:** ุงูุจุญุซ ุนู ุงูุทุงูุจ ูุชู ุจุงุณุชุฎุฏุงู `studentName` (`session.user.name`). ุงูุฃุณูุงุก ููุณุช ูุฑูุฏุฉุ ููุง ูุฏ ูุคุฏู ูุฑุจุท ุงูุจูุงูุงุช ุจุงูุทุงูุจ ุงูุฎุทุฃ.
    *   **ุงูุฅุตูุงุญ:** ุงุณุชุจุฏุงู ุงูุจุญุซ ุจุงูุงุณู ุจุงูุจุญุซ ุจู `userId` (`session.user.id`).

*   **`src/app/api/attendance/route.ts`**
    *   **ุงููุดููุฉ:** `GET` ูุณูุญ ูุฃู ูุณุชุฎุฏู ูุณุฌู ุจุฌูุจ ุจูุงูุงุช ุงูุญุถูุฑ ุฏูู ูููุฏ ูุงููุฉ.
    *   **ุงูุฅุตูุงุญ:** ูุตุฑ ุงููุตูู ุนูู `ADMIN` ู `TEACHER` (ูุญููุงุชูู) ู `STUDENT` (ูุณุฌููู).

---

## ๐ 2. ุชูุฑุงุฑ ูุชุถุงุฑุจ (Redundancy & Inconsistency)

*   **ุชูุฑุงุฑ ุฌูุจ ุงูุญููุงุช:**
    *   `src/app/api/attendance/teacher-courses/route.ts` (ูุณุชุฎุฏู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู)
    *   `src/app/api/courses/teacher-courses/route.ts` (ูุณุชุฎุฏู ID - **ุงูุฃูุถู**)
    *   **ุงูุญู:** ุงุนุชูุงุฏ `courses/teacher-courses` ูุญุฐู ุงูุขุฎุฑ ูุชุญุฏูุซ ุงูุฑูุงุจุท ูู ุงููุงุฌูุฉ.

*   **ูุธุงู ุงูููุงู (Tasks vs Points):**
    *   `src/app/api/points/daily-tasks/route.ts` (ุงููุณุชุฎุฏู ูุนููุงู ููููุงุท)
    *   `src/app/api/tasks/complete-task/route.ts` (Mock/Placeholder)
    *   `src/app/api/tasks/daily-tasks/route.ts` (Mock/Placeholder)
    *   **ุงูุญู:** ุญุฐู ูุฌูุฏ `src/app/api/tasks` ุจุงููุงูู ูุฃูู ุฒุงุฆุฏ ูุบูุฑ ูุณุชุฎุฏู.

*   **ุงุณุชูุฑุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
    *   ุจุนุถ ุงููููุงุช ุชุณุชุฎุฏู `import { db } from '@/lib/db'` (ุงููุนูุงุฑ).
    *   ุงูุจุนุถ ุงูุขุฎุฑ ูุณุชุฎุฏู `import { prisma } from '@/lib/db'`.
    *   **ุงูุญู:** ุชูุญูุฏ ุงูุงุณุชุฎุฏุงู ุฅูู `db`.

---

## โ๏ธ 3. ุฏููู ุชูููุฉ (Technical Debt)

*   **ููุชุฑุฉ ุงููุนููุฉ:**
    *   ุงูุนุฏูุฏ ูู ุงููุงุฌูุงุช (`enrollment`, `dashboard`) ุชุณุชุฎุฏู `userEmail` ูุฑุจุท ุงููุนููุฉ ุจุจูุงูุงุชูุง.
    *   **ุงูุญู:** ุงุณุชุฎุฏุงู `teacherId` (ุงูุฐู ูู ููุณู `userId`) ููุฑุจุท ุงููุจุงุดุฑ ูุงูุฃุณุฑุน.

*   **ุงุณุชุนูุงูุงุช Raw:**
    *   ูุงุฌูุงุช ูุซู `grades/behavior`, `grades/final-exam`, `points/daily-tasks` ุชุณุชุฎุฏู `$queryRaw` ู `$executeRawUnsafe`.
    *   **ุงูุญู:** ุชุญููููุง ูุงุณุชุฎุฏุงู Prisma Client (`db.behaviorGrade`, etc.) ููุงุณุชูุงุฏุฉ ูู Type Safetyุ ุฅูุง ุฅุฐุง ูุงู ููุงู ุณุจุจ ุชููู ูุงูุฑ.

---

## โ 4. ูุงุฌูุงุช ุณูููุฉ (Verified & Good)

*   `src/app/api/auth/[...nextauth]/route.ts`
*   `src/app/api/attendance/bulk-mark/route.ts`
*   `src/app/api/attendance/course-attendance/route.ts`
*   `src/app/api/grades/daily/route.ts`
*   `src/app/api/grades/monthly/route.ts`
*   `src/app/api/grades/weekly/route.ts`
*   `src/app/api/users/route.ts`

---

## ๐ ุฎุทุฉ ุงูุฅุตูุงุญ ุงูููุชุฑุญุฉ

1.  **ุงูุฃูุงู ุฃููุงู:** ุฅุตูุงุญ ุงูุซุบุฑุงุช ูู `grades/route.ts` ู `enrollment/manage-request` ู `enrollment/request`.
2.  **ุงูุชูุธูู:** ุญุฐู ุงููุงุฌูุงุช ุงูููุฑุฑุฉ (`attendance/teacher-courses`, `api/tasks/*`).
3.  **ุงูุชูุญูุฏ:** ุชุญุฏูุซ ุงุณุชูุฑุงุฏ `db` ูุชูุญูุฏ ููุทู ููุชุฑุฉ ุงููุนููุฉ ุจู `teacherId`.
